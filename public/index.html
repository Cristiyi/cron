<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="/styles/main.css">
    <title>任务列表</title>
  </head>
  <body>
    <div id="app">
      <div class="toolbar">
        <button class="button-primary">新增</button>
      </div>
      <table>
        <tr>
          <th width="200">id</th>
          <th width="100">单位</th>
          <th width="100">上次执行</th>
          <th>结果</th>
          <th>下次</th>
          <th>回调</th>
          <th>操作</th>
        </tr>
        <tr v-for="task in taskList">
          <td>{{task.id}}</td>
          <td>{{task.unit}}</td>
          <td>{{task.lastRun}}</td>
          <td>{{task.runResult}}</td>
          <td>{{task.time}}</td>
          <td>{{task.url}}</td>
          <td><a v-on:click="taskDel(task)">删除</a></td>
        </tr>
      </table>
      <div class="cron-dialog-wrapper">
        <div class="cron-dialog">
          <div>
            <label>周期</label>
            <select>
              <option v-for="item in units" :key="item">{{item}}</option>
            </select>
          </div>
          <div>
            <label>回掉地址</label>
            <input />
          </div>


        </div>
      </div>
    </div>
    <script>
    var GET_HEADER = {
      method:"GET",
      headers:{"Accept":"application/json"}
    }
    var app = new Vue({
      el:'#app',
      data:{
        units: ['Minute', 'Hour', 'Day', 'Week', 'Month', 'Year'],
        taskList:null
      },
      methods: {
        tasks: function() {
          fetch('/tasks', GET_HEADER)
          .then(function(response) {
              return response.json() })
          .then(json => {
              this.taskList = json; })
          .catch(error => {
              console.log(error); })
        },
        taskDel: function(task) {
          fetch('task/del/' + task.id, GET_HEADER)
          .then(resp => resp.json())
          .then(json => json["success"] === 0)
          .then(success => {
            this.taskList.splice(this.taskList.findIndex((t) => (t.id === task.id), 1));
          })
          .catch(error => {
              console.log(error);
          })
        }
      }
    });
    app.tasks();
    </script>
  </body>
</html>
